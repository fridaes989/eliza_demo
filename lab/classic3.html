<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三基金組合回測 - 墨鏡姐複利樹</title>
    <link href="https://cdn.jsdelivr.net/npm/vuetify@3.4.0/dist/vuetify.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@5.x/css/materialdesignicons.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="src/style.css">
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>載入中...</h3>
            <p>正在載入即時資訊</p>
        </div>
    </div>
    <div id="app">
        <v-app :theme="theme">
            <v-main>
                <v-container>
                    <v-row justify="center">
                        <v-toolbar color="transparent">
                            <v-toolbar-title class="text-h5 font-weight-bold text-primary">墨鏡姐複利樹</v-toolbar-title>
                            <v-spacer></v-spacer>
                            <v-btn text href="goal.html">財務規劃</v-btn>
                            <v-btn text href="all_weather.html">全天候策略</v-btn>
                            <v-btn text href="classic3.html" variant="tonal" color="primary">三基金組合</v-btn>
                            <v-btn text href="aggressive.html">積極型股債組合</v-btn>
                            <v-btn text href="core4.html">核心四基金</v-btn>
                            <v-btn text href="voo.html">巴菲特推薦</v-btn>
                        </v-toolbar>
                        
                            <v-card class="mt-4" flat color="transparent">
                              
                               <v-card-text>
                                <v-col cols="12" md="5">
                                  <h1>經典三基金組合</h1>
                                </v-col>
                                 <v-row>
                                    <!-- Performance & Allocation -->
                                    <v-col cols="12" md="5">
                                      
                                        <v-row>
                                            <v-col cols="12">
                                                <v-card>
                                                    
                                                    <v-card-title>績效表現</v-card-title>
                                                    <v-row dense class="pa-2">
                                                        <v-col cols="12" sm="6"><v-card color="surface-variant" flat><v-card-text><div class="text-caption">年化報酬率 (估)</div><div class="text-h5 font-weight-bold text-primary">{{ pct(portfolio.data.CAGR) }}</div></v-card-text></v-card></v-col>
                                                        <v-col cols="12" sm="6"><v-card color="surface-variant" flat><v-card-text><div class="text-caption">年化波動率</div><div class="text-h5 font-weight-bold text-white">{{ pct(portfolio.data.volatility) }}</div></v-card-text></v-card></v-col>
                                                        <v-col cols="12"><v-card color="surface-variant" flat><v-card-text><div class="text-caption">最大回撤</div><div class="text-h5 font-weight-bold text-error">{{ pct(portfolio.data.maxDrawdown) }}</div></v-card-text></v-card></v-col>
                                                    </v-row>
                                                </v-card>
                                            </v-col>
                                            <v-col cols="12">
                                                <v-card>
                                                    <v-card-title>組成標的與比例</v-card-title>
                                                    <v-card-text>
                                                        <div class="pie-chart-container"><canvas id="pie-chart"></canvas></div>
                                                        <v-row dense class="mt-4">
                                                            <v-col v-for="(percent, asset) in portfolio.data.allocations" :key="asset" cols="12" sm="6">
                                                                <div class="legend-item">
                                                                    <div class="legend-color" :style="{ backgroundColor: pieColors[Object.keys(portfolio.data.allocations).indexOf(asset)] }"></div>
                                                                    <div>{{ asset }}: {{ percent }}%</div>
                                                                </div>
                                                            </v-col>
                                                        </v-row>
                                                    </v-card-text>
                                                </v-card>
                                            </v-col>
                                        </v-row>
                                    </v-col>
                                    <!-- Backtest & Projection -->
                                    <v-col cols="12" md="7">
                                        <v-card class="h-100">
                                            <v-card-title>歷史回測 (與 S&P 500 比較)</v-card-title>
                                            <v-card-text>
                                                <v-chip-group v-model="backtestYears" mandatory color="primary">
                                                    <v-chip :value="3">近 3 年</v-chip>
                                                    <v-chip :value="5">近 5 年</v-chip>
                                                    <v-chip :value="10">近 10 年</v-chip>
                                                </v-chip-group>
                                                <div style="height: 380px;"><canvas id="backtest-chart"></canvas></div>
                                            </v-card-text>
                                        </v-card>
                                    </v-col>
                                   
                                 </v-row>
                               </v-card-text>
                            </v-card>
                        </v-col>
                    </v-row>
                </v-container>
            </v-main>
        </v-app>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@3.4.0/dist/vuetify.min.js"></script>
    <script>
        // Loading management
        document.addEventListener('DOMContentLoaded', function() {
            // Simulate loading time for libraries and ensure smooth transition
            setTimeout(() => {
                const loadingOverlay = document.getElementById('loadingOverlay');
                const app = document.getElementById('app');
                
                loadingOverlay.style.opacity = '0';
                app.style.opacity = '1';
                
                setTimeout(() => {
                    loadingOverlay.style.display = 'none';
                }, 500);
            }, 1500);
        });
        const { createApp, ref, watch, onMounted, nextTick } = Vue;
        const { createVuetify } = Vuetify;

        const customDarkTheme = { dark: true, colors: { background: '#0D0D0D', surface: 'rgba(0, 0, 0, .1)', 'surface-variant': 'rgba(13, 13, 13, .5)', primary: '#208065', secondary: '#806420', error: '#CF6679' } };
        const vuetify = createVuetify({ theme: { defaultTheme: 'dark', themes: { dark: customDarkTheme } } });

        createApp({
            setup() {
                const theme = ref('dark');
                const portfolio = { name: "三基金組合", data: { allocations: { VTI: 42, VXUS: 18, BND: 40 }, CAGR: 0.081, volatility: 0.105, maxDrawdown: -0.33 } };
                const csvData = `date,portfolio_monthly_return,portfolio_value,sp500_value\n2015-09,0.0,10000,10000\n2015-10,4.641281,10464,10852\n2015-11,0.083464,10473,10891\n2015-12,-1.358144,10331,10704\n2016-01,-2.976404,10023,10171\n2016-02,0.140376,10037,10162\n2016-03,4.785094,10518,10846\n2016-04,0.602034,10581,10887\n2016-05,0.856407,10671,11073\n2016-06,0.891452,10767,11112\n2016-07,2.648846,11052,11517\n2016-08,0.034062,11056,11531\n2016-09,0.256037,11084,11532\n2016-10,-1.649353,10901,11331\n2016-11,1.075025,11018,11749\n2016-12,1.293154,11161,11986\n2017-01,1.39074,11316,12201\n2017-02,2.276507,11574,12682\n2017-03,0.272845,11605,12696\n2017-04,1.061878,11728,12822\n2017-05,1.064156,11853,13005\n2017-06,0.522123,11915,13087\n2017-07,1.437206,12086,13356\n2017-08,0.479116,12144,13395\n2017-09,1.215328,12292,13665\n2017-10,1.283839,12450,13987\n2017-11,1.567908,12645,14414\n2017-12,0.987154,12770,14589\n2018-01,2.688853,13113,15410\n2018-02,-2.795057,12746,14851\n2018-03,-0.7758,12648,14444\n2018-04,-0.076668,12638,14518\n2018-05,1.522184,12830,14871\n2018-06,0.172254,12852,14958\n2018-07,1.88818,13095,15513\n2018-08,1.860865,13339,16007\n2018-09,-0.119146,13323,16102\n2018-10,-4.864418,12675,14990\n2018-11,1.409369,12853,15267\n2018-12,-4.403247,12287,13922\n2019-01,5.465654,12959,15036\n2019-02,1.9665,13214,15526\n2019-03,1.558516,13420,15805\n2019-04,2.261178,13723,16452\n2019-05,-3.051125,13304,15401\n2019-06,4.616228,13919,16474\n2019-07,0.654825,14010,16722\n2019-08,-0.146051,13989,16443\n2019-09,0.923299,14118,16763\n2019-10,1.511206,14332,17133\n2019-11,2.037762,14624,17753\n2019-12,1.68342,14870,18269\n2020-01,0.484876,14942,18261\n2020-02,-3.994062,14345,16817\n2020-03,-9.06352,13045,14717\n2020-04,8.484922,14152,16586\n2020-05,3.389449,14632,17376\n2020-06,1.787565,14893,17684\n2020-07,3.876225,15471,18725\n2020-08,3.685609,16041,20032\n2020-09,-2.123937,15700,19282\n2020-10,-1.476858,15468,18802\n2020-11,7.669026,16654,20846\n2020-12,2.714755,17107,21619\n2021-01,-0.526705,17016,21399\n2021-02,1.122931,17208,21994\n2021-03,1.533247,17471,22993\n2021-04,3.113774,18015,24209\n2021-05,0.538466,18112,24368\n2021-06,1.613016,18405,24915\n2021-07,1.243874,18634,25523\n2021-08,1.532632,18919,26283\n2021-09,-3.017702,18348,25057\n2021-10,3.701729,19027,26816\n2021-11,-0.999935,18837,26600\n2021-12,2.15294,19243,27831\n2022-01,-4.196711,18435,26363\n2022-02,-1.998482,18067,25585\n2022-03,0.608468,18177,26547\n2022-04,-6.881776,16926,24217\n2022-05,0.315223,16979,24272\n2022-06,-5.583615,16031,22270\n2022-07,6.135305,17015,24321\n2022-08,-3.414309,16434,23329\n2022-09,-7.266102,15240,21172\n2022-10,4.005627,15850,22893\n2022-11,5.128399,16663,24166\n2022-12,-3.863668,16019,22773\n2023-01,5.609949,16918,24205\n2023-02,-2.739795,16454,23597\n2023-03,2.393797,16848,24472\n2023-04,0.844219,16990,24863\n2023-05,-0.600172,16888,24977\n2023-06,3.382811,17460,26596\n2023-07,2.060137,17819,27467\n2023-08,-1.692967,17518,27020\n2023-09,-4.098735,16800,25739\n2023-10,-2.353219,16404,25180\n2023-11,7.268847,17597,27480\n2023-12,4.001084,18301,28734\n2024-01,0.403923,18375,29192\n2024-02,2.374645,18811,30715\n2024-03,1.946608,19177,31720\n2024-04,-3.548983,18497,30441\n2024-05,2.383748,18938,31981\n2024-06,2.545127,19420,33109\n2024-07,1.966926,19802,33510\n2024-08,1.772264,20152,34293\n2024-09,1.455396,20446,35013\n2024-10,-1.805473,20077,34701\n2024-11,3.860892,20852,36770\n2024-12,-2.984492,20229,35885\n2025-01,2.063108,20647,36849\n2025-02,-0.137753,20618,36381\n2025-03,-3.401522,19917,34354\n2025-04,-0.180554,19881,34056\n2025-05,3.27418,20532,36196\n2025-06,3.25979,21201,37944\n2025-07,0.925679,21398,38818\n2025-08,0.969379,21605,39188`;
                const backtestData = ref([]);
                const backtestYears = ref(3);
                const projectionYears = ref(10);
                const form = ref({ initial: 100000, monthly: 10000 });
                const projectionResult = ref({ invested: 0, value: 0 });
                const pieColors = ['#208065', '#40A080', '#60C0A0', '#80E0C0', '#A0FFA0', '#806420'];
                const charts = {};

                const parseCSV = (csv) => { const lines = csv.trim().split('\n'); const headers = lines.shift().split(','); return lines.map(line => { const values = line.split(','); const entry = {}; headers.forEach((h, i) => { entry[h.trim()] = isNaN(Number(values[i])) ? values[i] : Number(values[i]); }); return entry; }); };
                const createOrUpdateChart = (id, config) => { if (charts[id]) { charts[id].data = config.data; charts[id].options = config.options; charts[id].update(); } else { const ctx = document.getElementById(id)?.getContext('2d'); if (ctx) charts[id] = new Chart(ctx, config); } };
                const drawPieChart = () => createOrUpdateChart('pie-chart', { type: 'doughnut', data: { labels: Object.keys(portfolio.data.allocations), datasets: [{ data: Object.values(portfolio.data.allocations), backgroundColor: pieColors, borderWidth: 2, borderColor: '#0D0D0D' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } });
                const drawBacktestChart = () => { const slicedData = backtestData.value.slice(-(backtestYears.value * 12)); createOrUpdateChart('backtest-chart', { type: 'line', data: { labels: slicedData.map(d => d.date), datasets: [{ label: portfolio.name, data: slicedData.map(d => d.portfolio_value), borderColor: '#208065', tension: 0.1, pointRadius: 0 }, { label: 'S&P 500', data: slicedData.map(d => d.sp500_value), borderColor: '#806420', tension: 0.1, pointRadius: 0 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { ticks: { color: '#FFF' } }, y: { ticks: { color: '#FFF', callback: v => formatK(v) } } }, plugins: { legend: { labels: { color: '#FFF' } } } } }); };
                const drawProjectionChart = () => { const { data, invested, value } = buildProjectionSeries(); projectionResult.value = { invested, value }; createOrUpdateChart('projection-chart', { type: 'line', data: { labels: data.map(d => d.year), datasets: [{ label: '累積投入', data: data.map(d => d.invested), borderColor: '#806420', backgroundColor: 'rgba(128, 100, 32, 0.2)', fill: true, tension: 0.1 }, { label: '資產總額', data: data.map(d => d.value), borderColor: '#208065', backgroundColor: 'rgba(32, 128, 101, 0.2)', fill: true, tension: 0.1 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { ticks: { color: '#FFF' } }, y: { ticks: { color: '#FFF', callback: v => formatK(v) } } }, plugins: { legend: { labels: { color: '#FFF' } } } } }); };
                const buildProjectionSeries = () => { const { initial, monthly } = form.value; const data = []; let invested = initial, value = initial; const r = Math.pow(1 + portfolio.data.CAGR, 1 / 12) - 1; for (let y = 1; y <= projectionYears.value; y++) { for (let i = 0; i < 12; i++) { value = (value + monthly) * (1 + r); invested += monthly; } data.push({ year: `${y}年`, invested: Math.round(invested), value: Math.round(value) }); } return { data, invested, value }; };
                const formatK = (num) => { if (Math.abs(num) >= 1e6) return (num / 1e6).toFixed(2) + 'M'; if (Math.abs(num) >= 1e3) return (num / 1e3).toFixed(1) + 'K'; return num.toLocaleString(); };
                const pct = (n) => (n * 100).toFixed(1) + '%';
                
                watch(backtestYears, drawBacktestChart);
                watch([form, projectionYears], drawProjectionChart, { deep: true });
                onMounted(() => { backtestData.value = parseCSV(csvData); nextTick(() => { drawPieChart(); drawBacktestChart(); drawProjectionChart(); }); });

                return { theme, portfolio, backtestYears, projectionYears, form, projectionResult, pieColors, formatK, pct };
            }
        }).use(vuetify).mount('#app');
    </script>
</body>
</html>
